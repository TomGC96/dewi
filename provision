#!/usr/bin/env bash

sudo apt-get update
sudo apt-get install hostapd isc-dhcp-server git vim-nox tmux

sudo cp -v ./etc/dhcp.conf /etc/dhcp/dhcpd.conf
sudo cp -v ./etc/isc-dhcp-server /etc/default/isc-dhcp-server
sudo cp -v ./etc/interfaces /etc/network/interfaces

sudo ifconfig wlan0 192.168.11.1

sudo cp -v ./etc/hostapd.conf  /etc/hostapd/hostapd.conf
sudo cp -v ./etc/hostapd /etc/default/hostapd
sudo cp -v ./etc/sysctl.conf /etc/sysctl.conf

sudo sh -c "echo 1 > /proc/sys/net/ipv4/ip_forward"

sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
sudo iptables -A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT
sudo iptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT

sudo sh -c "iptables-save > /etc/iptables.ipv4.nat" 

wget http://www.adafruit.com/downloads/adafruit_hostapd.zip 
unzip adafruit_hostapd.zip

if [[ ! -f /usr/sbin/hostapd.ORIG ]]; then
    sudo mv -v /usr/sbin/hostapd /usr/sbin/hostapd.ORIG
fi

sudo mv -v hostapd /usr/sbin
sudo chmod 755 /usr/sbin/hostapd

sudo service hostapd start
sudo service isc-dhcp-server start
sudo update-rc.d hostapd enable
sudo update-rc.d isc-dhcp-server enable 
